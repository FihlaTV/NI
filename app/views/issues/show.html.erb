<%- model_class = Issue -%>

<% if can? :update, @issue %>
<div class="edit-issue-buttons">
  <%= link_to t('.edit', :default => t("helpers.links.edit")),
                edit_issue_path(@issue), :class => 'btn btn-primary btn-mini' %>
  <% if can? :destroy, @issue %>
    <%= link_to t('.destroy', :default => t("helpers.links.destroy")),
          issue_path(@issue),
          :method => 'delete',
          :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure? Becuase if you delete this Issue, it will also delete all of the Articles and any purchases of this Issue. Are you really sure?')),
          :class => 'btn btn-mini btn-danger' %>
  <% end %>
   | 
  <% if can? :create, Article %>
    <%= link_to 'New Article', new_issue_article_path(@issue), :class => 'btn btn-mini btn-success' %>
     |
    <%= link_to 'Import articles', issue_import_path(@issue), :class => 'btn btn-mini btn-warning',
                :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure? Because this will try and import all the articles from Bricolage.')) %>
     |
    <%= link_to 'Import images', issue_import_images_path(@issue), :class => 'btn btn-mini btn-warning',
                :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure? This will try and import all the images for each article listed here.')) %>
  <% end %>
</div>
<% end %>

<div class="page-header issue-title">
  <h1><%= @issue.title %></h1>
  <h2>NI <%= @issue.number %> - <%= @issue.release.strftime("%B, %Y") %></h2>
</div>

<div class="row-fluid">
  <div class="span6 issue-articles-container">
      <div class="issue-article keynote">
        <%= retina_image_tag @issue.cover_url(:thumb).to_s, :class => 'issue-cover shadow', :alt => "New Internationalist magazine: #{@issue.title}", :title => "New Internationalist magazine: #{@issue.title}", :size => "141x200" %>
        <h5>The big story</h5>
        <% if @issue.articles.find_by_keynote(true) %>
          <% @issue.articles.find_by_keynote(true) do |article| %>
            <%= render :partial => "article", :object => article %>
          <% end %>
        <% end %>
      </div>

      <% unless @issue.articles_of_category("/features/").blank? %>
        <h3>Features.</h3>
        <% @issue.articles_of_category("/features/").each do |article| %>
          <div class="issue-article">
            <%= render :partial => "article", :object => article %>
          </div>
        <% end %>
      <% end %>

      <% unless @issue.articles_of_category("/sections/agenda/").blank? %>
        <h3>Agenda.</h3>
        <% @issue.articles_of_category("/sections/agenda/").each do |article| %>
          <div class="issue-article">
            <%= render :partial => "article", :object => article %>
          </div>
        <% end %>
      <% end %>

  </div>
  <div class="span6 editors-letter">
    <% if @issue.editors_letter != "" %>
      <h3>A note from this month's editor</h3>
      <%= retina_image_tag @issue.editors_photo_url(:thumb).to_s, :class => 'editors-photo img-polaroid', :alt => "#{@issue.editors_name}", :title => "#{@issue.editors_name}", :width => "100" %>
      <%= simple_format @issue.editors_letter %>
      <p><strong><%= @issue.editors_name %></strong> for the New Internationalist co-operative.<br /><a href="http://www.newint.org">www.newint.org</a></p>
      <hr />
    <% end %>
  </div>
  <div class="span6 issue-articles-container">
    <% unless @issue.articles_of_category("/argument/").blank? %>
      <h3>Argument.</h3>
      <% @issue.articles_of_category("/argument/").each do |article| %>
        <div class="issue-article">
          <%= render :partial => "article", :object => article %>
        </div>
      <% end %>
    <% end %>

    <% unless @issue.articles_of_category("/columns/").blank? %>
      <h3>Regulars.</h3>
      <% @issue.articles_of_category("/columns/").each do |article| %>
        <div class="issue-article">
          <%= render :partial => "article", :object => article %>
        </div>
      <% end %>
    <% end %>

    <% unless @issue.articles_of_category("/blog/").blank? %>
      <h3>Blog.</h3>
      <% @issue.articles_of_category("/blog/").each do |article| %>
        <div class="issue-article">
          <%= render :partial => "article", :object => article %>
        </div>
      <% end %>
    <% end %>
  </div>
</div>

<div class="form-actions">
  <%= link_to t('.back', :default => t("helpers.links.back")),
              issues_path, :class => 'btn' %>
  <% if can? :create, Article %>
    <%= link_to 'New Article', new_issue_article_path(@issue), :class => 'btn btn-primary' %>
  <% end %>
</div>
